<!DOCTYPE html>
<html>
<head>
	<title>Canvas - pixels finger</title>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, user-scalable=yes"/>
	<meta property="og:title"       content="canvas - pixels finger"/>
	<meta property="og:url"         content="https://mr21.github.io/canvas-pixelsfinger/"/>
	<meta property="og:image"       content="https://mr21.github.io/canvas-pixelsfinger/thumbnail.jpg"/>
	<meta property="og:description" content="This webpage is an interesting demo for the multi-touch. The file canvas-pixelsfinger.js simulates the effect of a finger that we pass on a still fresh paint. In the same way as Photoshop, two parameters are considered: the size of the finger and its intensity."/>
	<link rel="stylesheet" href="../_/fa/css/font-awesome.min.css"/>
	<link rel="stylesheet" href="../_/header.css"/>
	<link rel="stylesheet" href="../canvasloth/src/canvasloth.css"/>
	<script src="../_/header.js"></script>
	<script src="../canvasloth/src/canvasloth.js"></script>
	<script src="canvas-pixelsfinger.js"></script>
	<style>
	.desc {
		width: 620px;
		margin: 25px auto;
		text-align: center;
		}
		.desc small {
			font-size: 11px;
			}
			.desc label + label {
				margin-left: 2em;
				}
		.desc input {
			width: 40px;
			text-align: right;
			color: #fff;
			border: 0;
			border-radius: 2px;
			background: rgba(0,0,0,.2);
			}

	.canvasloth {
		width: 620px;
		height: 420px;
		margin: 25px auto;
		outline-width: 1px;
		}
		.canvasloth-hud-below {
			font: 11px/14px sans-serif;
			}
		.canvasloth-hud-above {
			}
			.canvasloth-hud-above .btns {
				position: absolute;
				right: 10px;
				bottom: 10px;
				}
			.canvasloth-hud-above .btns * {
				font-weight: bold;
				}
	</style>
	<script>
	function main() {
		window.cnv = new Canvasloth({
			container: document.querySelector(".canvasloth"),
			context: "2d",
			// autoFocus: true,
			fps: 60,
			thisApp: {
				reset: function() {
					var
						ctx = this.ctx,
						cnv = this.cnv,
						w = cnv.getWidth(),
						h = cnv.getHeight()
					;
					ctx.fillStyle = "#222";
					ctx.fillRect(0, 0, w, h);
					ctx.drawImage(
						this.img,
						(w - this.img.width) / 2,
						(h - this.img.height) / 2
					);
				},
				finger: function(e) {
					var
						cnv = this.cnv,
						w = cnv.getWidth(),
						h = cnv.getHeight(),
						zoom = cnv.getZoom(),
						rad = Math.max(e.radiusX, e.radiusY)
					;
					pixelsFinger(
						this.ctx,
						(rad > 2 ? rad : this.opt_radius) * this.cnv.getZoom(),
						(e.x - e.rx) * zoom,
						(e.y - e.ry) * zoom,
						e.x * zoom,
						e.y * zoom,
						e.force || this.opt_intensity
					);
				}
			},
			ready: function(o) {
				var
					that = this,
					isFullscreen = false
				;
				this.ctx = o.ctx;
				this.cnv = o.canvasloth;
				this.img = this.cnv.image("tests.png");
				this.isClicked = false;
				this.cnv.container.querySelector(".reset").onclick = function() {
					that.reset();
				};
				this.reset();
				this.cnv.container.querySelector(".fullscreen").onclick = function() {
					that.cnv.fullscreen(isFullscreen = !isFullscreen);
					this.firstChild.className = isFullscreen
						? "fa fa-compress"
						: "fa fa-expand";
				};
				// options
				var inp = document.querySelector(".desc .int input");
				inp.onchange = function(e) {
					var v = (parseInt(this.value) || 0) / 100;
					if (v < 0) v = 0;
					else if (v > 1) v = 1;
					that.opt_intensity = v;
				};
				inp.onchange();
				inp = document.querySelector(".desc .size input");
				inp.onchange = function(e) {
					var v = (parseInt(this.value) || 0) / 2;
					if (v < 0) v = 0;
					else if (v > 250) v = 250;
					that.opt_radius = v;
				};
				inp.onchange();
			},
			loop: function() {
			},
			events: {
				keyDown: function(e) {
					if (e.key === 32)
						this.reset();
				},
				mouseDown: function(e) {
					this.isClicked = true;
				},
				mouseUp: function(e) {
					this.isClicked = false;
				},
				mouseMove: function(e) {
					if (this.isClicked)
						this.finger(e);
				},
				touchMove: function(e) {
					this.finger(e);
				}
			}
		});
	}

	window.onload = main;
	</script>
</head>
<body>
	<div id="header">
		<i class="fa fa-fw fa-hand-o-right"></i>
		<h1>Canvas - pixels finger</h1>
	</div>

	<div class="desc">
		<p>
			Have fun by moving your fingers on these items below.<br/>
			<small>On mobile the intensity is automatically set by the force you exercise on the screen with your fingers.</small>
		</p>
		<form action="/">
			<label class="int">
				<span><b>Intensity</b>&nbsp;:</span>
				<input value="70" type="number" step="1" min="0" max="100" name="intensity"/>
				<span>%</span>
			</label>
			<label class="size">
				<span><b>Size</b>&nbsp;:</span>
				<input value="25" type="number" step="1" min="0" max="500" name="size"/>
				<span>px</span>
			</label>
		</form>
	</div>

	<div class="canvasloth">
		<div class="canvasloth-assets">
			<img src="tests.png"/>
		</div>
		<div class="canvasloth-hud-below">
		</div>
		<div class="canvasloth-hud-above">
			<div class="btns">
				<button class="reset"><i class="fa fa-eraser"></i> Reset</button>
				<button class="fullscreen"><i class="fa fa-expand"></i></button>
			</div>
		</div>
	</div>
</body>
</html>
